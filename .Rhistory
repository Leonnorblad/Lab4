names(temp) <- colnames(X)
cat("Coefficients:\n")
temp
},
plot = function(){
# Data preperation for the first plot:
# A data.frame with x (fitted) and y (residuals) variables
plot_data1 <- data.frame(e_hat=result$e_hat,
y_hat=result$y_hat)
# Calculate the median residual for each fitted value
plot_median_data <- aggregate(plot_data1$e_hat, list(plot_data1$y_hat), FUN=median)
colnames(plot_median_data) <- c("y_hat", "median")
# Creating a data.frame with: Residuals, fitted values and the median for each fitted value
plot_data <- merge(plot_data1, plot_median_data, by="y_hat")
# Finding outliers
qunts <- quantile(plot_data$e_hat, probs = c(0.02, 0.98))
# Criteras
smaller <- qunts[[1]]
larger <- qunts[[2]]
out <- which(plot_data$e_hat > larger | plot_data$e_hat < smaller)
# If not outlier -> NA
plot_data$outlier <-NA
# Saves the obs numbers of the outliers
plot_data$outlier[out] <- out
# Plot 1 - Residuals Vs fitted
p1 <- ggplot(data=plot_data, aes(y=e_hat, x=y_hat)) +
geom_point(shape=1, size=3) +
geom_hline(aes(yintercept=0), linetype='dotted', color="gray") +
geom_line(color='red', data = plot_data, aes(x=y_hat, y=median)) +
geom_text(aes(label = outlier), na.rm = TRUE, hjust=-0.3) +
labs(y="Residuals",
x = paste("Fitted values\nlm(",format(formula),")", sep=""),
title="Residuals Vs Fitted") +
theme_bw() +
theme(plot.title = element_text(hjust=0.5),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank())
# Data preperation for the second plot:
# Uses the data.frame with x (fitted) and y (residuals) variables
plot_data2 <- plot_data1
# Transforming the residuals
plot_data2$e_hat <- sqrt(abs(scale(plot_data1$e_hat)))
# Calculate the median residual for each fitted value
plot_median_data2 <- aggregate(plot_data2$e_hat, list(plot_data$y_hat), FUN=median)
colnames(plot_median_data2) <- c("y_hat", "median")
# Creating a data.frame with: Residuals, fitted values and the median for each fitted value
plot_data_stan <- merge(plot_data2, plot_median_data2, by="y_hat")
# Finding outliers
qunts <- quantile(plot_data_stan$e_hat, probs = c(0.02, 0.98))
# Criteras
smaller <- qunts[[1]]
larger <- qunts[[2]]
out <- which(plot_data_stan$e_hat > larger | plot_data_stan$e_hat < smaller)
# If not outlier -> NA
plot_data_stan$outlier <-NA
# Saves the obs numbers of the outliers
plot_data_stan$outlier[out] <- out
# Plot 2 - Scale-Location
p2 <- ggplot(data=plot_data_stan, aes(y=e_hat, x=y_hat)) +
geom_point(shape=1, size=3) +
geom_hline(aes(yintercept=0), linetype='dotted', color="gray") +
geom_line(color='red', data = plot_data_stan, aes(x=y_hat, y=median)) +
geom_text(aes(label = outlier), na.rm = TRUE, hjust=-0.3) +
labs(y=bquote(sqrt("|Standardized Residuals|")),
x = paste("Fitted values\nlm(",format(formula),")", sep=""),
title="Scale-Location") +
theme_bw() +
theme(plot.title = element_text(hjust=0.5),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank())
return(list(p1,p2))
},
pred = function(){
return(result$y_hat)
},
coef = function(){
return(result$beta_hat)
},
resid = function(){
return(result$e_hat)
},
summary = function(){
data_frame <- data.frame(Estimate = as.vector(result$beta_hat),
"Std. Error" = as.vector(diag(sqrt(abs(result$var_beta_hat)))),
t_value = result$t_beta,
p_value = result$p_value)
rownames(data_frame)<-rownames(result$beta_hat)
colnames(data_frame)<-c("Estimate", "Std. Error", "t value", "p value")
vec<-as.vector(sqrt(result$sigma_2_hat)[1])
cat("Coefficients:\n")
print.data.frame(data_frame)
cat("\nResidual standard error:", vec, "on", result$df,  "degrees of freedom.")
}
)
)
example <- linreg(data=iris, formula=Petal.Length~Species)
example$summary()
library(Lab4Pack)
browseVignettes("Lab4Pack")
library(Lab4Pack)
browseVignettes("Lab4Pack")
devtools::load_all(".")
devtools::load_all(".")
library(Lab4Pack)
devtools::load_all(".")
rm(list = c("linreg"))
devtools::load_all(".")
install.packages("devtools")
install.packages("testthat")
devtools::build_vignettes()
deltools::build_package()
devtools::build_package()
devtools::build()
devtools::load_all(".")
?Lab4Pack
devtools::load_all(".")
browseVignettes("Lab4Pack")
browseVignettes("Lab4Pack")
library(Lab4Pack)
browseVignettes("Lab4Pack")
build_vignettes(
pkg = ".",
dependencies = "VignetteBuilder",
clean = TRUE,
upgrade = "never",
quiet = FALSE,
install = TRUE,
keep_md = TRUE
)
devtools::build_vignettes(
pkg = ".",
dependencies = "VignetteBuilder",
clean = TRUE,
upgrade = "never",
quiet = FALSE,
install = TRUE,
keep_md = TRUE
)
browseVignettes("Lab4Pack")
devtools::load_all(".")
devtools::install(build_vignettes=TRUE)
browseVignettes("Lab4Pack")
devtools::install(build_vignettes=TRUE)
browseVignettes("Lab4Pack")
library(Lab4Pack)
library(Lab4Pack)
library(Lab4Pack)
linreg_mod <- linreg$new(Petal.Length~Sepal.Width+Sepal.Length, data=iris)
linreg_mod$summary()
test<-lm(Petal.Length~Sepal.Width+Sepal.Length, data=iris)
summary(test)
\\(Intercept\\)( )*-2.5[0-9]*( )*0.5[0-9]*( )*-4.4[0-9]*( )*.*( )*\\*\\*\\*
2
\\(Intercept\\)( )*-2.5[0-9]*( )*0.5[0-9]*( )*-4.4[0-9]*( )*.*( )*\\*\\*\\*
p_vals <- c(0,0,0)
sig_level <- rep("", length(p_vals))
sig_level
sig_level <- rep(" ", length(p_vals))
sig_level
length(p_vals)
\\(Intercept\\)( )*-2.5[0-9]*( )*0.5[0-9]*( )*-4.4[0-9]*( )*.*( )*\\*\\*\\*
p_vals <- c(0,0,0)
sig_level <- rep(" ", length(p_vals))
for(i in 1:length(p_vals)){
if(p_vals[i]<0.1){sig_level[i]<-0.1}
}
sig_level
for(i in 1:length(p_vals)){
if(p_vals[i]<0.1){sig_level[i]<-"."}
if(p_vals[i]<0.05){sig_level[i]<-"*"}
}
sig_level
\\(Intercept\\)( )*-2.5[0-9]*( )*0.5[0-9]*( )*-4.4[0-9]*( )*.*( )*\\*\\*\\*
p_vals <- c(0,0.4,0.04)
sig_level <- rep(" ", length(p_vals))
for(i in 1:length(p_vals)){
if(p_vals[i]<0.1){sig_level[i]<-"."}
if(p_vals[i]<0.05){sig_level[i]<-"*"}
}
sig_level
\\(Intercept\\)( )*-2.5[0-9]*( )*0.5[0-9]*( )*-4.4[0-9]*( )*.*( )*\\*\\*\\*
p_vals <- c(0,0.4,0.04)
sig_level <- rep(" ", length(p_vals))
for(i in 1:length(p_vals)){
if(p_vals[i]<0.1){sig_level[i]<-"."}
if(p_vals[i]<0.05){sig_level[i]<-"*"}
if(p_vals[i]<0.01){sig_level[i]<-"**"}
if(p_vals[i]<0.001){sig_level[i]<-"***"}
}
sig_level
\\(Intercept\\)( )*-2.5[0-9]*( )*0.5[0-9]*( )*-4.4[0-9]*( )*.*( )*\\*\\*\\*
p_vals <- c(0,0.4,0.04, 0.001, 0.05, 0.031)
sig_level <- rep(" ", length(p_vals))
for(i in 1:length(p_vals)){
if(p_vals[i]<0.1){sig_level[i]<-"."}
if(p_vals[i]<0.05){sig_level[i]<-"*"}
if(p_vals[i]<0.01){sig_level[i]<-"**"}
if(p_vals[i]<0.001){sig_level[i]<-"***"}
}
sig_level
example <- linreg(data=iris, formula=Petal.Length~Species)
example$summary()
devtools::load_all(".")
library(Lab4Pack)
linreg <- setRefClass("linreg",
fields = list(result ="list",
data = "data.frame",
df_name ="character",
formula = "formula",
beta_hat = "matrix",
y_hat ="matrix",
e_hat = "matrix",
df = "numeric",
sigma_2_hat = "matrix",
var_beta_hat = "matrix",
t_beta = "matrix",
p_value = "matrix",
X = "matrix",
y = "numeric"),
methods = list(
initialize = function(formula, data){
formula <<-formula
df_name <<- as.character(substitute(data))
X <<- model.matrix(formula, data)                # Independen variable(s)
y <<- data[,all.vars(formula)[1]]                     # Dependent variable
# Beta (Regression coefficients)
result$beta_hat <<- solve(t(X)%*%X)%*%t(X)%*%y
# Fitted values
result$y_hat <<- X%*%result$beta_hat
# Residuals
result$e_hat <<- y-result$y_hat
# Degrees of freedom
n <- nrow(X)       # Number of obs
p <- ncol(X)       # Number of variables
result$df <<- n-p  # Degrees of freedom
# The residual variance
result$sigma_2_hat <<- t(result$e_hat)%*%result$e_hat/result$df
# The variance of the regression coefficients
result$var_beta_hat <<- result$sigma_2_hat[1]*solve(t(X)%*%X)
# The t-values for each coefficient
result$t_beta <<- result$beta_hat/sqrt(diag(result$var_beta_hat))
# p-values
result$p_value <<- 2*(1-pt(result$t_beta, result$df))
},
print = function(){
cat("Call:\nlinreg(formula = ", format(formula), ", data = ", df_name,")\n\n", sep="")
temp <- as.vector(result$beta_hat)
names(temp) <- colnames(X)
cat("Coefficients:\n")
print.data.frame(temp)
},
plot = function(){
# Data preperation for the first plot:
# A data.frame with x (fitted) and y (residuals) variables
plot_data1 <- data.frame(e_hat=result$e_hat,
y_hat=result$y_hat)
# Calculate the median residual for each fitted value
plot_median_data <- aggregate(plot_data1$e_hat, list(plot_data1$y_hat), FUN=median)
colnames(plot_median_data) <- c("y_hat", "median")
# Creating a data.frame with: Residuals, fitted values and the median for each fitted value
plot_data <- merge(plot_data1, plot_median_data, by="y_hat")
# Finding outliers
qunts <- quantile(plot_data$e_hat, probs = c(0.02, 0.98))
# Criteras
smaller <- qunts[[1]]
larger <- qunts[[2]]
out <- which(plot_data$e_hat > larger | plot_data$e_hat < smaller)
# If not outlier -> NA
plot_data$outlier <-NA
# Saves the obs numbers of the outliers
plot_data$outlier[out] <- out
# Plot 1 - Residuals Vs fitted
p1 <- ggplot(data=plot_data, aes(y=e_hat, x=y_hat)) +
geom_point(shape=1, size=3) +
geom_hline(aes(yintercept=0), linetype='dotted', color="gray") +
geom_line(color='red', data = plot_data, aes(x=y_hat, y=median)) +
geom_text(aes(label = outlier), na.rm = TRUE, hjust=-0.3) +
labs(y="Residuals",
x = paste("Fitted values\nlm(",format(formula),")", sep=""),
title="Residuals Vs Fitted") +
theme_bw() +
theme(plot.title = element_text(hjust=0.5),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank())
# Data preperation for the second plot:
# Uses the data.frame with x (fitted) and y (residuals) variables
plot_data2 <- plot_data1
# Transforming the residuals
plot_data2$e_hat <- sqrt(abs(scale(plot_data1$e_hat)))
# Calculate the median residual for each fitted value
plot_median_data2 <- aggregate(plot_data2$e_hat, list(plot_data$y_hat), FUN=median)
colnames(plot_median_data2) <- c("y_hat", "median")
# Creating a data.frame with: Residuals, fitted values and the median for each fitted value
plot_data_stan <- merge(plot_data2, plot_median_data2, by="y_hat")
# Finding outliers
qunts <- quantile(plot_data_stan$e_hat, probs = c(0.02, 0.98))
# Criteras
smaller <- qunts[[1]]
larger <- qunts[[2]]
out <- which(plot_data_stan$e_hat > larger | plot_data_stan$e_hat < smaller)
# If not outlier -> NA
plot_data_stan$outlier <-NA
# Saves the obs numbers of the outliers
plot_data_stan$outlier[out] <- out
# Plot 2 - Scale-Location
p2 <- ggplot(data=plot_data_stan, aes(y=e_hat, x=y_hat)) +
geom_point(shape=1, size=3) +
geom_hline(aes(yintercept=0), linetype='dotted', color="gray") +
geom_line(color='red', data = plot_data_stan, aes(x=y_hat, y=median)) +
geom_text(aes(label = outlier), na.rm = TRUE, hjust=-0.3) +
labs(y=bquote(sqrt("|Standardized Residuals|")),
x = paste("Fitted values\nlm(",format(formula),")", sep=""),
title="Scale-Location") +
theme_bw() +
theme(plot.title = element_text(hjust=0.5),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank())
return(list(p1,p2))
},
pred = function(){
return(result$y_hat)
},
coef = function(){
return(result$beta_hat)
},
resid = function(){
return(result$e_hat)
},
summary = function(){
sig_level <- rep(" ", length(result$p_value))
for(i in 1:length(result$p_value)){
if(result$p_value[i]<0.1){sig_level[i]<-"."}
if(result$p_value[i]<0.05){sig_level[i]<-"*"}
if(result$p_value[i]<0.01){sig_level[i]<-"**"}
if(result$p_value[i]<0.001){sig_level[i]<-"***"}
}
data_frame <- data.frame(Estimate = as.vector(result$beta_hat),
"Std. Error" = as.vector(diag(sqrt(abs(result$var_beta_hat)))),
t_value = result$t_beta,
p_value = result$p_value,
sig_level = sig_level)
rownames(data_frame)<-rownames(result$beta_hat)
colnames(data_frame)<-c("Estimate", "Std. Error", "t value", "p value", "")
vec<-as.vector(sqrt(result$sigma_2_hat)[1])
cat("Coefficients:\n")
print.data.frame(data_frame)
cat("\nResidual standard error:", vec, "on", result$df,  "degrees of freedom.")
}
)
)
linreg <- setRefClass("linreg",
fields = list(result ="list",
data = "data.frame",
df_name ="character",
formula = "formula",
beta_hat = "matrix",
y_hat ="matrix",
e_hat = "matrix",
df = "numeric",
sigma_2_hat = "matrix",
var_beta_hat = "matrix",
t_beta = "matrix",
p_value = "matrix",
X = "matrix",
y = "numeric"),
methods = list(
initialize = function(formula, data){
formula <<-formula
df_name <<- as.character(substitute(data))
X <<- model.matrix(formula, data)                # Independen variable(s)
y <<- data[,all.vars(formula)[1]]                     # Dependent variable
# Beta (Regression coefficients)
result$beta_hat <<- solve(t(X)%*%X)%*%t(X)%*%y
# Fitted values
result$y_hat <<- X%*%result$beta_hat
# Residuals
result$e_hat <<- y-result$y_hat
# Degrees of freedom
n <- nrow(X)       # Number of obs
p <- ncol(X)       # Number of variables
result$df <<- n-p  # Degrees of freedom
# The residual variance
result$sigma_2_hat <<- t(result$e_hat)%*%result$e_hat/result$df
# The variance of the regression coefficients
result$var_beta_hat <<- result$sigma_2_hat[1]*solve(t(X)%*%X)
# The t-values for each coefficient
result$t_beta <<- result$beta_hat/sqrt(diag(result$var_beta_hat))
# p-values
result$p_value <<- 2*(1-pt(result$t_beta, result$df))
},
print = function(){
cat("Call:\nlinreg(formula = ", format(formula), ", data = ", df_name,")\n\n", sep="")
temp <- as.vector(result$beta_hat)
names(temp) <- colnames(X)
cat("Coefficients:\n")
print.data.frame(temp)
},
plot = function(){
# Data preperation for the first plot:
# A data.frame with x (fitted) and y (residuals) variables
plot_data1 <- data.frame(e_hat=result$e_hat,
y_hat=result$y_hat)
# Calculate the median residual for each fitted value
plot_median_data <- aggregate(plot_data1$e_hat, list(plot_data1$y_hat), FUN=median)
colnames(plot_median_data) <- c("y_hat", "median")
# Creating a data.frame with: Residuals, fitted values and the median for each fitted value
plot_data <- merge(plot_data1, plot_median_data, by="y_hat")
# Finding outliers
qunts <- quantile(plot_data$e_hat, probs = c(0.02, 0.98))
# Criteras
smaller <- qunts[[1]]
larger <- qunts[[2]]
out <- which(plot_data$e_hat > larger | plot_data$e_hat < smaller)
# If not outlier -> NA
plot_data$outlier <-NA
# Saves the obs numbers of the outliers
plot_data$outlier[out] <- out
# Plot 1 - Residuals Vs fitted
p1 <- ggplot(data=plot_data, aes(y=e_hat, x=y_hat)) +
geom_point(shape=1, size=3) +
geom_hline(aes(yintercept=0), linetype='dotted', color="gray") +
geom_line(color='red', data = plot_data, aes(x=y_hat, y=median)) +
geom_text(aes(label = outlier), na.rm = TRUE, hjust=-0.3) +
labs(y="Residuals",
x = paste("Fitted values\nlm(",format(formula),")", sep=""),
title="Residuals Vs Fitted") +
theme_bw() +
theme(plot.title = element_text(hjust=0.5),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank())
# Data preperation for the second plot:
# Uses the data.frame with x (fitted) and y (residuals) variables
plot_data2 <- plot_data1
# Transforming the residuals
plot_data2$e_hat <- sqrt(abs(scale(plot_data1$e_hat)))
# Calculate the median residual for each fitted value
plot_median_data2 <- aggregate(plot_data2$e_hat, list(plot_data$y_hat), FUN=median)
colnames(plot_median_data2) <- c("y_hat", "median")
# Creating a data.frame with: Residuals, fitted values and the median for each fitted value
plot_data_stan <- merge(plot_data2, plot_median_data2, by="y_hat")
# Finding outliers
qunts <- quantile(plot_data_stan$e_hat, probs = c(0.02, 0.98))
# Criteras
smaller <- qunts[[1]]
larger <- qunts[[2]]
out <- which(plot_data_stan$e_hat > larger | plot_data_stan$e_hat < smaller)
# If not outlier -> NA
plot_data_stan$outlier <-NA
# Saves the obs numbers of the outliers
plot_data_stan$outlier[out] <- out
# Plot 2 - Scale-Location
p2 <- ggplot(data=plot_data_stan, aes(y=e_hat, x=y_hat)) +
geom_point(shape=1, size=3) +
geom_hline(aes(yintercept=0), linetype='dotted', color="gray") +
geom_line(color='red', data = plot_data_stan, aes(x=y_hat, y=median)) +
geom_text(aes(label = outlier), na.rm = TRUE, hjust=-0.3) +
labs(y=bquote(sqrt("|Standardized Residuals|")),
x = paste("Fitted values\nlm(",format(formula),")", sep=""),
title="Scale-Location") +
theme_bw() +
theme(plot.title = element_text(hjust=0.5),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank())
return(list(p1,p2))
},
pred = function(){
return(result$y_hat)
},
coef = function(){
return(result$beta_hat)
},
resid = function(){
return(result$e_hat)
},
summary = function(){
sig_level <- rep(" ", length(result$p_value))
for(i in 1:length(result$p_value)){
if(result$p_value[i]<0.1){sig_level[i]<-"."}
if(result$p_value[i]<0.05){sig_level[i]<-"*"}
if(result$p_value[i]<0.01){sig_level[i]<-"**"}
if(result$p_value[i]<0.001){sig_level[i]<-"***"}
}
data_frame <- data.frame(Estimate = as.vector(result$beta_hat),
"Std. Error" = as.vector(diag(sqrt(abs(result$var_beta_hat)))),
t_value = result$t_beta,
p_value = result$p_value,
sig_level = sig_level)
rownames(data_frame)<-rownames(result$beta_hat)
colnames(data_frame)<-c("Estimate", "Std. Error", "t value", "p value", "")
vec<-as.vector(sqrt(result$sigma_2_hat)[1])
cat("Coefficients:\n")
print.data.frame(data_frame)
cat("\nResidual standard error:", vec, "on", result$df,  "degrees of freedom.")
}
)
)
example <- linreg(data=iris, formula=Petal.Length~Species)
example$summary()
example <- linreg(data=iris, formula=Petal.Length~Species)
example$summary()
?LiU_theme
usethis::use_github_action_check_standard()
?linreg
?LiU_theme
?Lab4Pack
browseVignettes("Lab4Pack")
devtools::install(build_vignettes=TRUE)
browseVignettes("Lab4Pack")
library(Lab4Pack)
build_vignettes()
require(devtools)
build_vignettes()
